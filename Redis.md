# Redis

### 特征
    * 多样的数据模型（string set list sortedset hash）
        字符串使用的SDS字符串数据对象，包含len和字符数组，比起C原始字符串效率更快
        链表用于列表键
        字典类似HashMap存储（两个数组，分别用于正常访问和扩容复制），通过渐进式rehash实现扩容
    * 持久化
    * 主从同步 master将数据同步到slave，典型分布式读写分离模型
    
### 数据持久化
    * RDB快照（默认） 性能高但容易丢失数据
    * AOF
    
### 说明
    * 单进程单线程 利用队列技术将并发访问变为串行访问
    * 通过watch机制实现乐观锁流程
    
### 回收策略
    * 从已设置过期数据中挑选最近最少使用的淘汰
    * 从已设置过期数据中挑选将要过期的淘汰
    * 从已设置过期数据中任意选择数据淘汰
    * 从数据集中挑选最近最少使用的淘汰
    * 从数据集中任意选择数据淘汰
    * 禁止驱逐数据(默认)

### 过期删除策略
* 定时删除 给key建立定时器，到达时间删除
* 被动删除 调用key值判断删除
* 定期删除 定时任务检测到时间删除
    
### 核心对象
    
    redisObject
    type encoding vm ptr
    
### 处理命令逻辑

    1. 从多路复用框架中select出已经ready的文件描述符（ready标准是已到达内核、已准备写入数据）
    2. 对每个文件描述符已准备的事件进行处理，处理完相同文件描述符的事件后，再处理下一个（事件类型分为连接请求、请求命令、将暂存的执行结果写回客户端）
    3. 客户端命令执行结束后，处理定时任务
    4. 本次循环完毕，进入下一次循环的beforeSleep逻辑（处理数据过期、持久化写入等任务）